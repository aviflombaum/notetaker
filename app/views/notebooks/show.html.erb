

  <div class="col-md-10 col-md-offset-1">
    <div class="row notebookSection">
      <h1 class="page-header"><%= @notebook.title %></h1>
      <div class="inline">
        <%= link_to 'Back', notebook_path(@notebook), :class => "btn btn-xs btn-default" %>
        <% if current_user.id == @notebook.user_id %>
          <%= link_to 'New Note', new_notebook_note_path(@notebook, @note), :class => "btn btn-xs btn-default" %>
          <%= link_to "Delete", @notebook, method: :delete, data: {confirm: "Are you sure you want to delete this notebook?"}, :class => "btn btn-xs btn-default" %>
        <% end %>
      </div>
      <p><%= pluralize(@notebook.reference_count, 'reference') %>  in this notebook</p>

    </div>

    <div class="row notebookNoteSection">
      <% @notebook.notes.each do |note|  %>
        <div class="single-note">
          <h4 class="noteName"> <%= note.id %>: <%= link_to note.name, note_path(note)%></h4>
          <p>Updated at: <%=note.updated_at.strftime("%D") %> </p>
          <div id="content-<%= note.id %>"> <%=truncate(note.content, length: 100) %></div>
          <button class='js-more btn' data-id='<%= note.id %>'> More...</button>
        </div>

      <% end %>
    </div>
  </div>



  <div id="noteResult">
    <h2 id="noteName"></h2>
    <p id="noteContent"></p>
  </div>

<!--  NOTES FORM -->
  <%= form_for @notebook.notes.build do |f| %>
    <div class="form-group">
      <%= f.label :reference_link, :class => "control-label" %>
      <%= f.select :reference_id, Reference.all.collect { |r| [r.reference_link, r.id]}, include_blank: :true, :class => "form-control" %>
    </div>


    <div class="form-group">
        <%= f.label :name, :class => "control-label" %>
        <%= f.text_field :name, :class => "form-control" %>
    </div>

    <div class="form-group">
        <%= f.label :content, :class => "control-label" %>
        <%= f.text_area :content, :class => "form-control" %>
    </div>

    <%= f.submit "Submit", :class => "btn btn-default" %>
  <% end %>


  <!--  JS -->

  <script type="text/javascript" charset="UTF-8">
    $(function(){
      $('form').submit(function(event){
        event.preventDefault();
        var values = $(this).serialize();
        var posting = $.post('/notes', values);
        debugger;
        posting.done(function(data) {
          var note = data["note"];
          $("#noteName").text(note["name"]);
          $("#noteContent").text(note["content"]);
        });
      });

    });

    function Note (name, content){
      this.name = name;
      this.content = content;
      this.showNote = function(){
        console.log("You created a new note " + this.name);
      }
    };



  $(function () {
    $(".js-more").on('click', function() {
      // get the id from the data attribute
      var id = $(this).data("id");
      $.get("/notes/" + id + "/content", function(data) {
        // alert(data);
        $("#content-" + id).text(data);
      });
    });
  });

  </script>
